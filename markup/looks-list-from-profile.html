<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
   <title></title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="./css/style.css"/>
    <link rel="stylesheet" type="text/css" href="./js/fancybox/jquery.fancybox-1.3.4.css"/>
    <script type="text/javascript" src="./js/jquery-1.4.3.min.js"></script>
    <script type="text/javascript" src="./js/ajaxupload.js"></script>
    <script type="text/javascript" src="./js/fancybox/jquery.fancybox-1.3.4.pack.js"></script>

    <script type="text/javascript">
    var globData;
    function cancelEdit(id){
	var form = $("#"+id);
	var formEl = form.find('form');
	form.fadeOut();
	setTimeout(function(){
	    formEl.trigger( 'reset' );;
	    form.css('top','auto');
	},"1000");

    };
function replaceStrTmpl(str,data){
    for(i in data){
	str.replace("=>"+i+"<=",data[i]);
    }
    return str;
}

function getCloItem(id){
    $.ajax({
	url:"#",
	dataType:"json",
	method:"post",
	error:function(obj){
	    //alert(obj.responseText);
	},
	success:function(data){
	    globData = data;
	}
    });
}

function getLook(id){
    $.ajax({
	url:"#",
	dataType:"json",
	method:"post",
	error:function(obj){
	    //alert(obj.responseText);
	},
	success:function(data){
	    $('input[name="photo"]').val(data['photo']);
	    $('img#look-photo').attr('src',data['photo']);
	    $('select[name="look-whereto"] option[value="'+data['whereto']+'"]').attr("selected", "selected");
	    $('input[name="id"]').val(data['id']);
	    $.fancybox({
		href:"#edit-look-form-cont"
	    });
	}
    });
}

function publishLook(id){
    $.ajax({
	url:"#",
	dataType:"json",
	method:"post",
	error:function(obj){
	    //alert(obj.responseText);
	},
	success:function(data){
	    $.fancybox.close();
	    $('#look-'+id).find('.edit-look-link-cont').remove();
	}
    });
}

function saveLook(id){
    $.ajax({
	url:"#",
	dataType:"json",
	method:"post",
	error:function(obj){
	    //alert(obj.responseText);
	},
	success:function(data){
	    $.fancybox.close();
	}
    });
}

function delCloItem(id){
    $.ajax({
	url:"#",
	dataType:"json",
	method:"post",
	error:function(obj){
	    //alert(obj.responseText);
	},
	success:function(data){
	    $('#item-'+id).remove();
	}
    });
}

function getCloLineForm(id){
    var startFrom = 0;
    var form = $("#clo-item-form");

    if(id){
	startFrom = $("#item-"+id).offset().top;
	getCloItem(id);
	for(i in globData){
	    form.find('input[name="'+i+'"]').val(globData[i]);
	}
    }
    if(startFrom){
	form.find('input[name="clo-item-id"]').val(id);
	form.css('top',parseInt(startFrom-100)+"px");
    }
    form.slideDown();
}

function addCloLine(data){
    var tmpl = '<li><span class="category">=>category<=</span><ul><li><span class="clo-list-capt">бренд:</span>&nbsp;<a href="#">=>brand<=</a></li><li><span class="clo-list-capt">магазин:</span>&nbsp;<a href="#">=>shop<=</a></li></ul></li>';
    $("#clo-items-list").prepend(replaceStrTmpl(tmpl,data));
}

function editCloLine(data){
    var tmpl = '<span class="category">=>category<=</span><ul><li><span class="clo-list-capt">бренд:</span>&nbsp;<a href="#">=>brand<=</a></li><li><span class="clo-list-capt">магазин:</span>&nbsp;<a href="#">=>shop<=</a></li></ul>';
    saveCloItem(data);
    $("#item-"+globData['id']).html(replaceStrTmpl(tmpl,globData));
}

$(function(){
    $('a.call-upload-form').ajaxUpload
    (
        {
	    url:'http://lagidze.b2b/admin/uploadimg',
	    secureuri:false,
	    name:'custom_img',
	    onSubmit:function() {

	    },
	    onComplete: function (data, status)
	    {
		//var obj = jQuery.parseJSON(data);
		$.fancybox({
		    href:"#edit-look-form-cont"
		});
	    }
        }
    );
    $('.edit-look-link-cont').click(function(){

	$.fancybox({
	    href:"#edit-look-form-cont"
	});
    });
    $('#clo-select').click(function(){
	getCloLineForm(0);
	return false;
    });
    $('.cancel').click(function(){
	cancelEdit("clo-item-form");
	return false;
    });
    $('.save-data').click(function(){
	cloId = $('#clo-item-form').find('input[name="clo-item-id"]');
	$.ajax({
	    url:"",
	    data:'look-id='+$('#edit-look-form-cont').find('input[name="id"]')+'&'+$('#clo-item-form').find('input').serialize(),
	    dataType:"json",
	    method:"post",
	    error:function(obj){
		alert(obj.responseText);
	    },
	    success:function(data){
		if(cloId){
		    editCloLine(data);
		} else {
		    addCloLine(data);
		}
		cancelEdit("clo-item-form");
	    }
	});
	return false;
    });
});
</script>
	  </head>
	  <body>
	    <div id="wrap">
	      <div id="head-wrap">
		<div id="head">
		  <div id="logo">YLG Logo</div>
		</div>
	      </div>
	      <div id="content-wrap">
		<div id="left-sidebar">
		  <div id="left-sidebar-menu">
		    <ul>
		      <li>menupoint</li>
		      <li>menupoint</li>
		      <li>как я вам?
			<ul>
			  <li><a href="#edit-look-form-cont" class="call-upload-form">загрузить фотографию</a></li>
			  <li>submenupoint</li>
			  <li>submenupoint</li>
			  <li>submenupoint</li>
			</ul>
		      </li>
		      <li>menupoint</li>
		      <li>menupoint</li>
		      <li>menupoint</li>
		    </ul>
		  </div>
		</div>
		<div id="content">
		  <div class="floated-items">
		    <div class="floated-item" id="look-1">
		      <div class="item-img">
			<a href="#"><img src="" width="200" height="250"/></a>
		      </div>
		      <div class="item-data">
			some data
		      </div>
		    </div>
		    <div class="floated-item" id="look-2">
		      <div class="item-img">
			<a href="#"><img src="" width="200" height="250"/></a>
		      </div>
		      <div class="item-data">
			some data
		      </div>
		    </div>
		    <div class="floated-item" id="look-3">
		      <div class="item-img">
			<a href="#"><img src="" width="200" height="250"/></a>
		      </div>
		      <div class="item-data">
			some data
		      </div>
		    </div>
		    <div class="floated-item" id="look-4">
		      <div class="item-img">
			<img src="" width="200" height="250"/>
		      </div>
		      <a href="#" class="edit-look-link-cont">редактировать</a>
		      <div class="item-data">
			some data
		      </div>
		    </div>
		    <div class="floated-item" id="look-5">
		      <div class="item-img">
			<img src="" width="200" height="250"/>
		      </div>
		      <a href="#" class="edit-look-link-cont">редактировать</a>
		      <div class="item-data">
			some data
		      </div>
		    </div>
		    <div class="floated-item" id="look-6">
		      <div class="item-img">
			<img src="" width="200" height="250"/>
		      </div>
		      <a href="#" class="edit-look-link-cont">редактировать</a>
		      <div class="item-data">
			some data
		      </div>
		    </div>
		  </div>
		</div>
		<div style="clear:both"></div>
	      </div>
	      <div style="display:none">
		<div id="edit-look-form-cont">
		  <form action="#">
		    <input type="hidden" name="look-photo" value="" />
		    <input type="hidden" name="id" value="" />
		    <div id="edit-look-form-wrap">
		      <div id="edit-look-form-photo-wrap">
			<div id="edit-look-form-photo">
			  <img src="" width="470" />
			</div>
			<div id="edit-look-form-filters">
			  <div class="edit-look-form-filter"><img src="" /></div>
			  <div class="edit-look-form-filter"><img src="" /></div>
			  <div class="edit-look-form-filter"><img src="" /></div>
			  <div class="edit-look-form-filter"><img src="" /></div>
			  <div class="edit-look-form-filter"><img src="" /></div>
			  <div class="edit-look-form-filter"><img src="" /></div>
			</div>
		      </div>
		      <div id="edit-look-form-clothes">
			<h2>ВЫБЕРИТЕ НУЖНОЕ</h2>
			<h3>Куда пойдем?</h3>
			<select name="look-whereto" size="5" multiple="multiple">
			  <option value="1">на работу</option>
			  <option value="2">домой</option>
			  <option value="3">на работу</option>
			  <option value="4">домой</option>
			  <option value="5">домой</option>
			  <option value="6">на работу</option>
			  <option value="7">на работу</option>
			  <option value="8">на работу</option>
			</select>
			<div id="clo-select">
			  <a href="#"><span class="greyed">+</span>&nbsp;добавить предмет гардероба</a>
			</div>
			<div id="clo-item-form" style="display:none">
			  <input type="hidden" name="clo-item-id" value="" />
			  <div class="form-line-narr"><span class="title">Категория:</span>&nbsp;<div class="data"><input type="text" name="category" /></div><div style="clear:both"></div></div>
			  <div class="form-line-narr"><span class="title">Бренд:</span>&nbsp;<div class="data"><input type="text" name="brand" /></div><div style="clear:both"></div></div>
			  <div class="form-line-narr"><span class="title">Магазин:</span>&nbsp;<div class="data"><input type="text" name="shop" /></div><div style="clear:both"></div></div>
			  <div class="form-line-narr"><span class="title" style="text-align:right"><a href="#" class="cancel">отменить</a></span>&nbsp;<div class="data"><input type="button" name="save-0" class="save-data" value="сохранить" /></div><div style="clear:both"></div></div>
			</div>
			<ul id="clo-items-list">
			  <li id="item-1">
			    <span class="category">Кофта</span>
			    <ul>
			      <li class="brand"><span class="clo-list-capt">бренд:</span>&nbsp;<a href="#">ZARA</a></li>
			      <li class="shop"><span class="clo-list-capt">магазин:</span>&nbsp;<a href="#">ZARA</a></li>
			    </ul>
			    <div class="eddel-block"><a href="#" class="edit" onclick="getCloLineForm(1)">ред.</a><br/><a href="#" onclick="delCloItem(1)" class="del">del.</a></div>
			  </li>
			  <li id="item-2">
			    <span class="category">Кофта</span>
			    <ul>
			      <li class="brand"><span class="clo-list-capt">бренд:</span>&nbsp;<a href="#">ZARA</a></li>
			      <li class="shop"><span class="clo-list-capt">магазин:</span>&nbsp;<a href="#">ZARA</a></li>
			    </ul>
			    <div class="eddel-block"><a href="#" class="edit" onclick="getCloLineForm(2)">ред.</a><br/><a href="#" onclick="getCloLineForm(2)" class="del">del.</a></div>
			  </li>
			  <li id="item-3">
			    <span class="category">Кофта</span>
			    <ul>
			      <li class="brand"><span class="clo-list-capt">бренд:</span>&nbsp;<a href="#">ZARA</a></li>
			      <li class="shop"><span class="clo-list-capt">магазин:</span>&nbsp;<a href="#">ZARA</a></li>
			    </ul>
			    <div class="eddel-block"><a href="#" class="edit" onclick="getCloLineForm(3)">ред.</a><br/><a href="#" onclick="getCloLineForm(3)" class="del">del.</a></div>
			  </li>
			</ul>
		      </div>
		      <div style="clear:both"></div>
		      <div id="look-edit-actions-wrap">
			<div id="look-edit-actions">
			  <div id="save-button">
			    <input type="button" id="save-button" value="Сохранить"/>
			  </div>
			  <div id="publish-button">
			    <input type="button" id="publish-button" value="Опубликовать" />
			  </div>
			</div>
		      </div>
		      <div style="clear:both">
		      </div>
		    </form>
		  </div>
		</div>
	      </div>
	    </div>
	  </div>
	</body>
    </html>
